\ProvidesPackage{color-env}[2020/10/31 color-env]

%%%%%%%%%%%%%%%%
% Requirements %
%%%%%%%%%%%%%%%%

\RequirePackage{xcolor}
\RequirePackage{graphicx}
\RequirePackage[framemethod=TikZ]{mdframed}  %% for colored framed boxes
\RequirePackage{framed}  %% for problem 
\RequirePackage{amsthm}  %% for theorem environment 
\RequirePackage{enumerate}   
%%%%%%%%%%%%%%%%%%
%  Environments  %
%%%%%%%%%%%%%%%%%%
%command
\newcommand{\U}{\mathcal{U}}
\newcommand{\id}{\mathrm{id}}
\newcommand{\Hom}{\mathrm{Hom}}
\newcommand{\Ext}{\mathrm{Ext}}
\newcommand{\Tor}{\mathrm{Tor}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\OO}{\mathcal{O}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\HH}{\mathbb{H}}
\newcommand{\RP}{\mathbb{RP}}
\newcommand{\dd}{\mathrm{d}}
\newcommand{\HdR}[1]{H_{\mathrm{dR}}^#1}
\newcommand{\ii}{\sqrt{-1}}
\newcommand{\la}{\langle}
\newcommand{\ra}{\rangle}
\newcommand{\pa}[3][]{
	\frac{\partial^{#1} #2}{\partial {#3}^{#1}}
	}
\newcommand{\bpa}{\bar{\partial}}
\newcommand{\npa}{\partial}
%%%%%%%% Problem %%%%%%%%%%%%%
\colorlet{shadecolor}{orange!12}
\newtheorem{prob}{Problem}
\newenvironment{problem}
{\begin{shaded}\begin{prob}}
		{\end{prob}\end{shaded}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%% THEOREM %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcounter{theo}[section] \setcounter{theo}{0} %% counter
\renewcommand{\thetheo}{\arabic{chapter}.\arabic{section}.\arabic{theo}}
\newenvironment{theorem}[1][]{%
	\refstepcounter{theo}%
	\ifstrempty{#1}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=blue!20]
				{\strut Theorem~\thetheo};}}
	}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=blue!20]
				{\strut Theorem~\thetheo:~#1};}}%
	}%
	\mdfsetup{innertopmargin=10pt,linecolor=blue!20,%
		linewidth=2pt,topline=true,%
		frametitleaboveskip=\dimexpr-\ht\strutbox\relax
	}
	\begin{mdframed}[]\relax%
		}{\end{mdframed}}


%%%%%%%%%%%%%%% LEMMA %%%%%%%%%%%%%%%
\newcounter{lem}[section]\setcounter{lem}{0}
\renewcommand{\thelem}{\arabic{chapter}.\arabic{section}.\arabic{lem}}
\newenvironment{lemma}[1][]{%
	\refstepcounter{lem}%
	\ifstrempty{#1}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=orange!20]
				{\strut Lemma~\thelem};}}
	}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=orange!20]
				{\strut Lemma~\thelem:~#1};}}%
	}%
	\mdfsetup{innertopmargin=10pt,linecolor=orange!20,%
		linewidth=2pt,topline=true,%
		frametitleaboveskip=\dimexpr-\ht\strutbox\relax
	}
	\begin{mdframed}[]\relax%
		}{\end{mdframed}}

%%%%%%%%%%%%% DEFINITION %%%%%%%%%%%%%%%
\newcounter{def}[section]\setcounter{def}{0}
\renewcommand{\thedef}{\arabic{chapter}.\arabic{section}.\arabic{def}}
\newenvironment{definition}[1][]{%
	\refstepcounter{def}%
	\ifstrempty{#1}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=red!25]
				{\strut Definition~\thedef};}}
	}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=red!25]
				{\strut Definition~\thedef:~#1};}}%
	}%
	\mdfsetup{innertopmargin=10pt,linecolor=red!25,%
		linewidth=2pt,topline=true,%
		frametitleaboveskip=\dimexpr-\ht\strutbox\relax
	}
	\begin{mdframed}[]\relax%
		}{\end{mdframed}}
		%%%%%%%%%%%%% Remark %%%%%%%%%%%%%%%
\newcounter{rem}[section]\setcounter{rem}{0}
\renewcommand{\therem}{\arabic{chapter}.\arabic{section}.\arabic{rem}}
\newenvironment{remark}[1][]{%
	\refstepcounter{rem}%
	\ifstrempty{#1}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=orange!20]
				{\strut Remark~\therem};}}
	}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=orange!20]
				{\strut Definition~\therem:~#1};}}%
	}%
	\mdfsetup{innertopmargin=10pt,linecolor=red!25,%
		linewidth=2pt,topline=true,%
		frametitleaboveskip=\dimexpr-\ht\strutbox\relax
	}
	\begin{mdframed}[]\relax%
		}{\end{mdframed}}
%%%%%%%%%%%%%% COROLLARY %%%%%%%%%%%%%%%%%%
\newcounter{cor}[section]\setcounter{cor}{0}
\renewcommand{\thecor}{\arabic{chapter}.\arabic{section}.\arabic{cor}}
\newenvironment{corollary}[1][]{%
	\refstepcounter{cor}%
	\ifstrempty{#1}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=yellow!20]
				{\strut Corollary~\thecor};}}
	}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=yellow!20]
				{\strut Corollary~\thecor:~#1};}}%
	}%
	\mdfsetup{innertopmargin=10pt,linecolor=yellow!20,%
		linewidth=2pt,topline=true,%
		frametitleaboveskip=\dimexpr-\ht\strutbox\relax
	}
	\begin{mdframed}[]\relax%
		}{\end{mdframed}}

%%%%%%%%%%%%% PROPOSITIONS %%%%%%%%%%%%%%%%%%%
\newcounter{prop}[section]\setcounter{prop}{0}
\renewcommand{\theprop}{\arabic{chapter}.\arabic{section}.\arabic{prop}}
\newenvironment{proposition}[1][]{%
	\refstepcounter{prop}%
	\ifstrempty{#1}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=blue!25]
				{\strut Proposition~\theprop};}}
	}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=blue!25]
				{\strut Proposition~\theprop:~#1};}}%
	}%
	\mdfsetup{innertopmargin=10pt,linecolor=green!25,%
		linewidth=2pt,topline=true,%
		frametitleaboveskip=\dimexpr-\ht\strutbox\relax
	}
	\begin{mdframed}[]\relax%
    }{\end{mdframed}}
	%%%%%%%%%%%%% Example %%%%%%%%%%%%%%%
\newcounter{exa}[section]\setcounter{def}{0}
\renewcommand{\theexa}{\arabic{chapter}.\arabic{section}.\arabic{def}}
\newenvironment{example}[1][]{%
	\refstepcounter{def}%
	\ifstrempty{#1}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=green!25]
				{\strut Example~\theexa};}}
	}%
	{\mdfsetup{%
			frametitle={%
				\tikz[baseline=(current bounding box.east),outer sep=0pt]
				\node[anchor=east,rectangle,fill=green!25]
				{\strut Example~\theexa:~#1};}}%
	}%
	\mdfsetup{innertopmargin=10pt,linecolor=red!25,%
		linewidth=2pt,topline=true,%
		frametitleaboveskip=\dimexpr-\ht\strutbox\relax
	}
	\begin{mdframed}[]\relax%
		}{\end{mdframed}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\expandafter\let\expandafter\oldproof\csname\string\proof\endcsname
\let\oldendproof\endproof
\renewenvironment{proof}[1][\proofname]{%
	\oldproof[\bf \scshape \large #1]%
}{\oldendproof}
\renewcommand\qedsymbol{$\blacksquare$}  %% optional if you like it.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%
%\expandafter\let\expandafter\oldproof\csname\string\proof\endcsname
%\let\oldendproof\endproof
%\renewenvironment{proof}[1][\proofname]{%
%	\oldproof[\bf \scshape \large #1]%
%}{\oldendproof}
%%%%%%%%%%%%%%%%
%极限、余极限与滤过余极限的实现
\makeatletter
\newcommand{\Colim@}[2]{
  \vtop{\m@th\ialign{##\cr
    \hfil$#1\operator@font lim$\hfil\cr
    \noalign{\nointerlineskip\kern1.5\ex@}#2\cr
    \noalign{\nointerlineskip\kern-\ex@}\cr}}%
}
\newcommand{\Colim}{%
  \mathop{\mathpalette\Colim@{\rightarrowfill@\scriptscriptstyle}}\nmlimits@
}
\makeatother

\makeatletter
\newcommand{\Lim@}[2]{%
  \vtop{\m@th\ialign{##\cr
    \hfil$#1\operator@font lim$\hfil\cr
    \noalign{\nointerlineskip\kern1.5\ex@}#2\cr
    \noalign{\nointerlineskip\kern-\ex@}\cr}}%
}
\newcommand{\Lim}{%
  \mathop{\mathpalette\Lim@{\leftarrowfill@\scriptscriptstyle}}\nmlimits@
}
\makeatother


\makeatletter
\newcommand{\colim@}[2]{%
  \vtop{\m@th\ialign{##\cr
    \hfil$#1\operator@font oli~$\hfil \cr
    \noalign{\nointerlineskip\kern1.5\ex@}#2\cr
    \noalign{\nointerlineskip\kern-\ex@}\cr}}%
}
\newcommand{\colim}{%
  \mathop{\mathrm{c}\mathpalette\colim@{\rightarrowfill@\scriptscriptstyle}\mathrm{\!\!m}}\nmlimits@
}
\makeatother

\makeatletter
\newcommand{\cone@}[1]{%
  \vtop{\m@th\ialign{##\cr
    \hfil$#1\operator@font cone$\hfil\cr
    \noalign{\nointerlineskip\kern1.5\ex@}\cr
    \noalign{\nointerlineskip\kern-\ex@}\cr}}%
}
\newcommand{\cone}{%
  \mathop{\mathpalette\cone@{\scriptscriptstyle}}\nmlimits@
}
\makeatother


